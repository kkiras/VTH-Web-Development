<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add New Shoe</title>
    <link rel="stylesheet" href="/stylesheet/create.css">
</head>
<body>
    <h1>Add New Shoe</h1>
    <nav>
        <div>
            <a href="/pages/list.html" >
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-grid h-5 w-5 text-green-600"><rect width="7" height="7" x="3" y="3" rx="1"></rect><rect width="7" height="7" x="14" y="3" rx="1"></rect><rect width="7" height="7" x="14" y="14" rx="1"></rect><rect width="7" height="7" x="3" y="14" rx="1"></rect></svg>
                <span>Shoe List</span>
            </a>
            <a href="/pages/create.html" class="active">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-plus h-5 w-5 text-gray-500"><circle cx="12" cy="12" r="10"></circle><path d="M8 12h8"></path><path d="M12 8v8"></path></svg>
                <span>Add Shoe</span>
            </a>
            <a href="/update">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-pen h-5 w-5 text-gray-500"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"></path></svg>
                <span>Update Shoe</span>
            </a>
            <a href="/delete-shoe">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2 h-5 w-5 text-gray-500"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>
                <span>Delete Shoe</span>
            </a>
            <a href="/search" class="active">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                <span>Search</span>
            </a>
        </div>
    </nav>

    <div class="container">
        <div class="form-section">
            <form id="shoeForm">
                <div class="form-group">
                    <label for="id">ID</label>
                    <input type="text" id="id" name="id" readonly style="background-color: #ddd;">
                </div>
                <div class="form-group">
                    <label for="name">Name</label>
                    <input type="text" id="name" name="name" oninput="updatePreview()">
                </div>
                <div class="form-group">
                    <label for="image">Image</label>
                    <div class="image-upload" id="imageUploadArea">
                        <input type="file" id="image" name="image" accept="image/png, image/jpeg, image/gif" onchange="previewImage(event)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload h-8 w-8 text-green-600"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" x2="12" y1="3" y2="15"></line></svg>
                        <p>Click to upload or drag and drop</p>
                        <p>PNG, JPG, GIF up to 10MB</p>
                    </div>
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" oninput="updatePreview()"></textarea>
                </div>
                <div class="form-group inline">
                    <div>
                        <label for="price">Price</label>
                        <input type="text" id="price" name="price" oninput="updatePreview()">
                    </div>
                    <div>
                        <label for="stock">Stock</label>
                        <input type="number" id="stock" name="stock" oninput="updatePreview()">
                    </div>
                </div>
                <div class="form-group inline">
                    <div>
                        <label for="color">Color</label>
                        <input type="text" id="color" name="color" oninput="updatePreview()">
                    </div>
                    <div>
                        <label for="brand">Brand</label>
                        <select id="brand" name="brand" oninput="updatePreview()">
                            <option value="Puma">Puma</option>
                            <option value="Nike">Nike</option>
                            <option value="Adidas">Adidas</option>
                        </select>
                    </div>
                </div>

                <div class="form-group inline">
                    <div>
                        <label for="type">Type</label>
                        <select id="type" name="type" oninput="updatePreview()">
                            <option value="Sneaker">Sneaker</option>
                            <option value="Runner">Runner</option>
                            <option value="Casual">Casual</option>
                        </select>
                    </div>
                    <div>
                        <label for="gender">Gender</label>
                        <select id="gender" name="gender" oninput="updatePreview()">
                            <option value="Female">Female</option>
                            <option value="Male">Male</option>
                            <option value="Unisex">Unisex</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Available Sizes</label>
                    <div class="sizes">
                        <label><input type="checkbox" name="size[]" value="36" onchange="updatePreview()"> 36</label>
                        <label><input type="checkbox" name="size[]" value="37" onchange="updatePreview()"> 37</label>
                        <label><input type="checkbox" name="size[]" value="38" onchange="updatePreview()"> 38</label>
                        <label><input type="checkbox" name="size[]" value="39" onchange="updatePreview()"> 39</label>
                        <label><input type="checkbox" name="size[]" value="40" onchange="updatePreview()"> 40</label>
                        <label><input type="checkbox" name="size[]" value="41" onchange="updatePreview()"> 41</label>
                        <label><input type="checkbox" name="size[]" value="42" onchange="updatePreview()"> 42</label>
                        <label><input type="checkbox" name="size[]" value="43" onchange="updatePreview()"> 43</label>
                        <label><input type="checkbox" name="size[]" value="44" onchange="updatePreview()"> 44</label>
                        <label><input type="checkbox" name="size[]" value="45" onchange="updatePreview()"> 45</label>
                    </div>
                </div>

                <div id="json-field-toggle">
                    <p>Import Shoes from JSON</p>
                    <p>></p>
                </div>

                <div id="json-content">
                    <div class="form-group">
                        <div class="json-file-upload" id="json-fileUploadArea">
                            <input type="file" id="json-file" name="json-file" accept=".json" onchange="previewJSON(event)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload h-8 w-8 text-green-600"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" x2="12" y1="3" y2="15"></line></svg>
                            <p>Click to upload or drag and drop a JSON file</p>
                            <p>The JSON should contain an array of shoe objects</p>
                            <p id="json-fileName" class="hidden">Selected file: json-import</p>
                        </div>
    
                        <div id="jsonPreview" class="hidden">
                            <p id="json-summary">aaa</p>
                            <pre id="json-firstItem">aaa</pre>
                        </div>

                        <button type="button" id="btn-import-json" class="hidden" onclick="importJSON()">Import</button>
                    </div>
                </div>
                
                <button type="button" onclick="addNewShoe()" style="margin-bottom: 16px;">Add Shoe</button>
                <button type="button" onclick="submitNewShoes()">Submit Shoe</button>
            </form>
        </div>
        <div class="preview-section">
            <h3>Preview</h3>
            <div class="preview-card">
                <!-- Default Image Preview -->
                <div class="preview-image" id="previewImage">No Image</div>
                <div class="preview-details">
                    <h4 id="previewName">Puma Deviate Nitro Elite 2</h4>
                    <p id="previewPrice">6,800,000VND</p>
                </div>
                <!-- Detailed Preview (Hidden by Default) -->
                <div class="preview-details-hover" id="previewDetailsHover">
                    <div>
                        <h4 id="previewNameHover">Puma Deviate Nitro Elite 2</h4>
                        <p id="previewDescriptionHover">Bản nâng cấp với trọng lượng nhẹ hơn, tấm carbon giúp tối đa hóa tốc độ khi chạy.</p>
                        <div class="preview-info">
                            <p><strong>Category:</strong> <span id="previewCategoryHover">Giày Puma</span></p>
                            <p><strong>Color:</strong> <span id="previewColorHover">Cam, Xám</span></p>
                            <p><strong>Stock:</strong> <span id="previewStockHover">18 units</span></p>
                        </div>
                    </div>

                    <div>
                        <p><strong>Available Sizes:</strong></p>
                        <div class="preview-sizes" id="previewSizesHover">
                            <span>36</span><span>37</span><span>38</span><span>39</span><span>40</span><span>41</span><span>42</span>
                        </div>
                        <p id="previewPriceHover" class="preview-price-hover">6,800,000VND</p>
                    </div>

                </div>
            </div>
            <p class="hover-text">Hover over the card to see detailed information</p>
        </div>
    </div>
    <script>

        let highestID = "";
        let currentShoeID = "";
        fetch('/reload-shoes-added')
        .then(response => response.json())
        .then(data => {
            alert(data.message);
        })

        function abbreviateBrand(brand) {
            const brandUpperCase = brand.trim().toUpperCase();

            switch (brandUpperCase) {
                case "PUMA":
                return "PM";
                case "ADIDAS":
                return "AD";
                case "LI-NING":
                return "LN";
                case "NIKE":
                return "NK";
                default:
                return ""; 
            }
            }

            function abbreviateType(type) {
            return type
                .replace(/[^a-zA-Z]/g, '') //Loai bo ky tu dac biet va so trong type
                .substring(0, 3) // Lay 3 ky tu dau tien
                .toUpperCase();
            }
            function abbreviateGender(gender) {
            const genderUpperCase = gender.trim().toUpperCase();

            switch (genderUpperCase) {
                case "MALE":
                return "MA";
                case "FEMALE":
                return "FE";
                case "UNISEX":
                return "UN";
                default:
                return ""; 
            }
        }
        
        fetch('/highest-id')
        .then(response => response.json())
        .then(data => {
            highestID = data.highestId;
            console.log(highestID);
            const incrementedNumber = parseInt(highestID, 10) + 1;
            const newNumericPart = incrementedNumber.toString().padStart(3, '0');
            currentShoeID = newNumericPart;
            generateId(); 
        });
        function addNewShoe(){
            event.preventDefault();
            const form = document.getElementById('shoeForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            const selectedSizes = Array.from(document.querySelectorAll('input[name="size[]"]:checked'))
                            .map(checkbox => checkbox.value);
            data.size = selectedSizes;
            data.image = '';
            delete data['size[]'];
            console.log(data);

            fetch('/api/shoe', {
                method: 'POST',
                body: formData
            })
            .then(responese => responese.json())
            .then(data => {
                alert(data.message);
            });
            resetForm();
        }

        function submitNewShoes(){
            event.preventDefault();
            fetch('/api/shoes')
            .then(response => response.json())
            .then(data => {
                alert(data.message)
            });
            resetForm();
   
        }

        function resetForm(){
            document.getElementById('shoeForm').reset();
            document.getElementById('previewImage').innerText = 'No Image';
            updatePreview();
        }

        async function importJSON(){
            event.preventDefault();
            const fileInput = document.getElementById('json-file');
            const file = fileInput.files[0];
            if (!file) {    
                alert('Please select a JSON file to import.');
                return;
            };

            try {
                const text = await file.text(); //Chuyển file sang text          
                const jsonData = JSON.parse(text);

                fetch('/api/json-file', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: jsonData })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                });

            } catch (error) {
                alert('Failed to parse JSON: ' + error.message);
                return;
            }          

        }
        
        function generateId() {
            const brand = document.getElementById('brand').value;
            const type = document.getElementById('type').value;
            const gender = document.getElementById('gender').value;

            if (brand && type && gender) {
                const brandCode = abbreviateBrand(brand);   
                const typeCode = abbreviateType(type);     
                const genderCode = abbreviateGender(gender);

                const newId = `${brandCode}${typeCode}${genderCode}${currentShoeID}`;
                document.getElementById('id').value = newId;
            }
        }
        document.getElementById('brand').addEventListener('change', generateId);
        document.getElementById('type').addEventListener('change', generateId);
        document.getElementById('gender').addEventListener('change', generateId);
    </script>
    <script src="/javascripts/create.js"></script>
    
</body>
</html>